<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Injected Telemetry Monitor | Cybertect</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/assets/internal-base.css">
    <style>
        main { max-width: 1200px; margin: 0 auto; padding: 60px 24px 120px; }
        .tool-hero { text-align: left; margin-bottom: 32px; }
        .eyebrow { text-transform: uppercase; letter-spacing: 2px; font-size: 12px; color: var(--text-gray); margin-bottom: 12px; }
        h1 { font-size: 40px; margin-bottom: 12px; color: var(--text-dark); }
        .subtitle { font-size: 18px; color: var(--text-gray); max-width: 720px; }
        .panel { background: var(--light-gray); border: 1px solid var(--border); border-radius: 16px; padding: 32px; margin-bottom: 32px; box-shadow: 0 12px 30px rgba(15,23,42,0.08); }
        .panel h2 { font-size: 20px; margin-bottom: 16px; }
        .actions { display: flex; flex-direction: column; align-items: flex-start; gap: 8px; margin-bottom: 40px; }
        .run-btn { background: var(--blue); color: var(--white); padding: 14px 32px; border-radius: 999px; font-weight: 600; border: none; cursor: pointer; transition: opacity 0.2s, background 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .run-btn:hover:not(:disabled) { background: #1D4ED8; }
        .run-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .helper { font-size: 13px; color: var(--text-gray); }
        .scan-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.08);
            margin-bottom: 32px;
        }
        .scan-card h3 { font-size: 26px; margin-bottom: 8px; }
        .scan-card p { color: var(--text-gray); margin-bottom: 24px; }
        .scan-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 24px;
        }
        .scan-controls input {
            font-size: 16px;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            flex: 1;
            min-width: 250px;
        }
        .scan-controls button {
            background: var(--blue);
            color: var(--white);
            border: none;
            border-radius: 999px;
            padding: 12px 28px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .scan-controls button:hover:not(:disabled) { background: #1D4ED8; }
        .scan-controls button:disabled { opacity: 0.5; cursor: not-allowed; }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        .summary-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
        }
        .summary-card h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-gray);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .summary-card .value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-dark);
        }
        .summary-card .label {
            font-size: 13px;
            color: var(--text-gray);
            margin-top: 4px;
        }
        .filter-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .filter-controls label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-dark);
            cursor: pointer;
        }
        .filter-controls input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .download-btn {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 10px 20px;
            font-weight: 600;
            color: var(--text-dark);
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .download-btn:hover {
            background: var(--light-gray);
            border-color: var(--blue);
            color: var(--blue);
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
        }
        .results-table thead {
            background: var(--light-gray);
        }
        .results-table th {
            text-align: left;
            padding: 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            border-bottom: 2px solid var(--border);
        }
        .results-table th:hover {
            background: rgba(15, 23, 42, 0.04);
        }
        .results-table th.sort-asc::after {
            content: ' ▲';
            font-size: 10px;
        }
        .results-table th.sort-desc::after {
            content: ' ▼';
            font-size: 10px;
        }
        .results-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            color: var(--text-dark);
        }
        .results-table tbody tr:hover {
            background: var(--light-gray);
        }
        .results-table tbody tr:last-child td {
            border-bottom: none;
        }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .badge-injected {
            background: #FEE2E2;
            color: #991B1B;
        }
        .badge-not-injected {
            background: #D1FAE5;
            color: #065F46;
        }
        .badge-vendor {
            background: #DBEAFE;
            color: #1E40AF;
        }
        .badge-type {
            background: #F3F4F6;
            color: #374151;
        }
        .url-cell {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .url-cell a {
            color: var(--blue);
            text-decoration: none;
        }
        .url-cell a:hover {
            text-decoration: underline;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-gray);
        }
        .loading .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 12px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .error {
            background: #FEE2E2;
            border: 1px solid #FCA5A5;
            border-radius: 12px;
            padding: 16px;
            color: #991B1B;
            margin-bottom: 24px;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }
        .empty-state .material-icons {
            font-size: 64px;
            color: var(--border);
            margin-bottom: 16px;
        }
        @media (max-width: 640px) {
            .header { flex-direction: column; align-items: flex-start; }
            .top-menu { margin: 12px 0; width: 100%; justify-content: flex-start; }
            .dropdown { width: 100%; }
            .dropdown-toggle { width: 100%; justify-content: space-between; }
            .dropdown-menu { position: static; box-shadow: none; margin-top: 8px; width: 100%; }
            .scan-controls { flex-direction: column; }
            .scan-controls button { width: 100%; }
            .summary-cards { grid-template-columns: 1fr; }
            .results-table { font-size: 12px; }
            .results-table th,
            .results-table td { padding: 10px 8px; }
            .url-cell { max-width: 150px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <a href="/" class="cybertect-logo" aria-label="Cybertect home">
                <span class="cyber-text">cyber</span><span class="tect-text">tect</span><span class="com-text">.com</span>
            </a>
        </div>
        <nav class="top-menu">
            <a class="nav-pill nav-pill-link" href="/online-waste/" data-route="/online-waste">Online Waste</a>
            <div class="dropdown" data-dropdown>
                <button class="dropdown-toggle nav-pill" type="button" aria-haspopup="true" aria-expanded="false">
                    Waste Detection Tools
                    <span class="material-icons" aria-hidden="true">expand_more</span>
                </button>
                <div class="dropdown-menu" role="menu">
                    <a class="tool-link" href="/tools/cms-level-data-monitor/" data-route="/tools/cms-level-data-monitor">CMS Output Monitor</a>
                    <a class="tool-link" href="/tools/ad-level-impression-verification/" data-route="/tools/ad-level-impression-verification">Ad Impression Verification</a>
                    <a class="tool-link" href="/tools/analytics-integrity-diagnosis/" data-route="/tools/analytics-integrity-diagnosis">Analytics Integrity Diagnosis</a>
                    <a class="tool-link active" href="/tools/injected-telemetry-monitor/" data-route="/tools/injected-telemetry-monitor">Injected Telemetry Monitor</a>
                    <a class="tool-link" href="/tools/reverse-analytics-search/" data-route="/tools/reverse-analytics-search">Reverse Analytics Search</a>
                </div>
            </div>
        </nav>
        <button class="sign-in-btn">Sign in</button>
    </header>

    <main>
        <div class="tool-hero">
            <p class="eyebrow">Cybertect Toolbox</p>
            <h1>Injected Telemetry Monitor</h1>
            <p class="subtitle">Detect analytics and ad telemetry that is injected after initial HTML load via CMS plugins, tag managers, ad tech wrappers, CDNs, or malicious scripts.</p>
        </div>

        <section class="scan-card">
            <h3>Scan for Injected Telemetry</h3>
            <p>Enter a URL to scan for telemetry that is injected dynamically after page load.</p>
            <div class="scan-controls">
                <input 
                    type="url" 
                    id="urlInput" 
                    placeholder="https://example.com" 
                    aria-label="URL to scan"
                />
                <button type="button" id="scanBtn" onclick="startScan()">
                    <span class="material-icons" style="font-size: 18px;">radar</span>
                    <span>Scan</span>
                </button>
            </div>
            <p class="helper">The scanner will capture initial HTML, monitor DOM mutations, and track network requests to identify injected telemetry.</p>
        </section>

        <div id="errorContainer"></div>

        <div id="summaryContainer" style="display: none;">
            <div class="summary-cards" id="summaryCards"></div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 16px;">
                <div class="filter-controls">
                    <label>
                        <input type="checkbox" id="showInjectedOnly" onchange="filterResults()">
                        <span>Show only injected telemetry</span>
                    </label>
                </div>
                <button class="download-btn" onclick="downloadEvidence()">
                    <span class="material-icons" style="font-size: 18px;">download</span>
                    <span>Download Evidence Pack</span>
                </button>
            </div>

            <div style="overflow-x: auto;">
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable('vendor')">Vendor</th>
                            <th onclick="sortTable('type')">Type</th>
                            <th onclick="sortTable('injected')">Injected</th>
                            <th onclick="sortTable('injectionPhase')">Phase</th>
                            <th onclick="sortTable('firstSeen')">First Seen</th>
                            <th onclick="sortTable('url')">URL</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody"></tbody>
                </table>
            </div>
        </div>

        <div id="loadingContainer" style="display: none;">
            <div class="loading">
                <span class="spinner"></span>
                <span>Scanning for injected telemetry...</span>
            </div>
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <span class="material-icons">search_off</span>
            <h3>No scan results yet</h3>
            <p>Enter a URL above and click Scan to detect injected telemetry.</p>
        </div>
    </main>

    <script>
        let scanResults = null;
        let currentSort = { column: null, direction: 'asc' };

        document.addEventListener('DOMContentLoaded', () => {
            setActiveNav();
            initDropdowns();
        });

        async function startScan() {
            const urlInput = document.getElementById('urlInput');
            const scanBtn = document.getElementById('scanBtn');
            const errorContainer = document.getElementById('errorContainer');
            const loadingContainer = document.getElementById('loadingContainer');
            const summaryContainer = document.getElementById('summaryContainer');
            const emptyState = document.getElementById('emptyState');

            const url = urlInput.value.trim();
            if (!url) {
                errorContainer.innerHTML = '<div class="error">Please enter a URL to scan.</div>';
                return;
            }

            // Validate URL
            try {
                new URL(url.startsWith('http') ? url : 'https://' + url);
            } catch (e) {
                errorContainer.innerHTML = '<div class="error">Invalid URL format. Please enter a valid URL.</div>';
                return;
            }

            // Show loading state
            errorContainer.innerHTML = '';
            loadingContainer.style.display = 'block';
            summaryContainer.style.display = 'none';
            emptyState.style.display = 'none';
            scanBtn.disabled = true;
            scanBtn.innerHTML = '<span class="spinner" style="display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 0.8s linear infinite;"></span> <span>Scanning...</span>';

            try {
                const response = await fetch('/api/injected-telemetry-scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'Scan failed');
                }

                scanResults = result;
                displayResults(result);

            } catch (error) {
                errorContainer.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                loadingContainer.style.display = 'none';
            } finally {
                scanBtn.disabled = false;
                scanBtn.innerHTML = '<span class="material-icons" style="font-size: 18px;">radar</span> <span>Scan</span>';
            }
        }

        function displayResults(result) {
            const loadingContainer = document.getElementById('loadingContainer');
            const summaryContainer = document.getElementById('summaryContainer');
            const emptyState = document.getElementById('emptyState');
            const summaryCards = document.getElementById('summaryCards');
            const resultsBody = document.getElementById('resultsBody');

            loadingContainer.style.display = 'none';

            if (!result.findings || result.findings.length === 0) {
                emptyState.style.display = 'block';
                summaryContainer.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            summaryContainer.style.display = 'block';

            // Display summary cards
            const summary = result.summary || {};
            summaryCards.innerHTML = `
                <div class="summary-card">
                    <h4>Total Telemetry</h4>
                    <div class="value">${summary.totalTelemetry || 0}</div>
                    <div class="label">Findings detected</div>
                </div>
                <div class="summary-card">
                    <h4>Injected Telemetry</h4>
                    <div class="value">${summary.injectedTelemetry || 0}</div>
                    <div class="label">Dynamically injected</div>
                </div>
                <div class="summary-card">
                    <h4>Vendors Detected</h4>
                    <div class="value">${summary.vendorsDetected || 0}</div>
                    <div class="label">Unique vendors</div>
                </div>
            `;

            // Display table
            renderTable(result.findings);
        }

        function renderTable(findings) {
            const resultsBody = document.getElementById('resultsBody');
            const showInjectedOnly = document.getElementById('showInjectedOnly').checked;
            
            let filteredFindings = findings;
            if (showInjectedOnly) {
                filteredFindings = findings.filter(f => f.injected);
            }

            if (filteredFindings.length === 0) {
                resultsBody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--text-gray);">No results match the filter.</td></tr>';
                return;
            }

            resultsBody.innerHTML = filteredFindings.map(finding => {
                const vendor = finding.vendor || 'unknown';
                const type = finding.type || 'unknown';
                const injected = finding.injected ? 'Yes' : 'No';
                const injectionPhase = finding.injectionPhase || 'unknown';
                const firstSeen = finding.firstSeen ? new Date(finding.firstSeen).toLocaleString() : 'N/A';
                const url = finding.url || 'N/A';

                return `
                    <tr>
                        <td><span class="badge badge-vendor">${vendor}</span></td>
                        <td><span class="badge badge-type">${type}</span></td>
                        <td>
                            <span class="badge ${finding.injected ? 'badge-injected' : 'badge-not-injected'}">
                                ${injected}
                            </span>
                        </td>
                        <td>${injectionPhase}</td>
                        <td>${firstSeen}</td>
                        <td class="url-cell">
                            ${url !== 'N/A' ? `<a href="${url}" target="_blank" rel="noopener noreferrer" title="${url}">${truncateUrl(url)}</a>` : 'N/A'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function truncateUrl(url) {
            if (url.length <= 50) return url;
            return url.substring(0, 47) + '...';
        }

        function filterResults() {
            if (scanResults) {
                renderTable(scanResults.findings);
            }
        }

        function sortTable(column) {
            if (!scanResults || !scanResults.findings) return;

            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            const sorted = [...scanResults.findings].sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                if (column === 'firstSeen') {
                    aVal = aVal ? new Date(aVal).getTime() : 0;
                    bVal = bVal ? new Date(bVal).getTime() : 0;
                } else {
                    aVal = String(aVal || '').toLowerCase();
                    bVal = String(bVal || '').toLowerCase();
                }

                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });

            scanResults.findings = sorted;
            renderTable(sorted);

            // Update table header sort indicators
            document.querySelectorAll('.results-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            const header = event.target.closest('th');
            if (header) {
                header.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
            }
        }

        function downloadEvidence() {
            if (!scanResults) {
                alert('No scan results to download.');
                return;
            }

            const dataStr = JSON.stringify(scanResults, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `injected-telemetry-${scanResults.url.replace(/[^a-z0-9]/gi, '_')}-${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function setActiveNav() {
            const current = window.location.pathname.replace(/\/$/, '');
            document.querySelectorAll('[data-route]').forEach(link => {
                const route = (link.dataset.route || '').replace(/\/$/, '');
                if (route && route === current) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        function initDropdowns() {
            const dropdowns = document.querySelectorAll('[data-dropdown]');
            if (!dropdowns.length) return;

            const closeAll = () => {
                dropdowns.forEach(dropdown => {
                    const menu = dropdown.querySelector('.dropdown-menu');
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    if (menu) menu.classList.remove('show');
                    if (toggle) toggle.setAttribute('aria-expanded', 'false');
                });
            };

            dropdowns.forEach(dropdown => {
                const toggle = dropdown.querySelector('.dropdown-toggle');
                const menu = dropdown.querySelector('.dropdown-menu');
                if (!toggle || !menu) return;
                toggle.addEventListener('click', event => {
                    event.preventDefault();
                    event.stopPropagation();
                    const isOpen = menu.classList.toggle('show');
                    toggle.setAttribute('aria-expanded', String(isOpen));
                    if (isOpen) {
                        dropdowns.forEach(other => {
                            if (other === dropdown) return;
                            const otherMenu = other.querySelector('.dropdown-menu');
                            const otherToggle = other.querySelector('.dropdown-toggle');
                            if (otherMenu) otherMenu.classList.remove('show');
                            if (otherToggle) otherToggle.setAttribute('aria-expanded', 'false');
                        });
                    }
                });
            });

            document.addEventListener('click', event => {
                const target = event.target;
                if (!(target instanceof Element)) return;
                if (!target.closest('[data-dropdown]')) {
                    closeAll();
                }
            });

            document.addEventListener('keyup', event => {
                if (event.key === 'Escape') {
                    closeAll();
                }
            });
        }

        // Allow Enter key to trigger scan
        document.getElementById('urlInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                startScan();
            }
        });

        // AI Validate floating button
        (function() {
            const btn = document.createElement('button');
            btn.id = 'aiValidateTelemetry';
            btn.textContent = 'AI Validate';
            btn.style.position = 'fixed';
            btn.style.bottom = '16px';
            btn.style.right = '16px';
            btn.style.padding = '10px 14px';
            btn.style.background = '#2563EB';
            btn.style.color = '#fff';
            btn.style.border = 'none';
            btn.style.borderRadius = '8px';
            btn.style.cursor = 'pointer';
            btn.style.boxShadow = '0 8px 24px rgba(0,0,0,0.15)';
            document.body.appendChild(btn);

            async function mockValidate(payload) {
                await new Promise(res => setTimeout(res, 500));
                return {
                    status: 'done',
                    result: {
                        verdict: 'inconclusive',
                        confidence: 0.55,
                        key_findings: [
                            { title: 'Mock telemetry finding', detail: 'Simulated telemetry check', confidence: 0.55, evidence_refs: [] }
                        ],
                        duplicate_assessment: { has_duplicates: false, likely_tool_error: false, notes: 'mock' },
                        inflation_signals: [],
                        recommended_actions: ['Review injected scripts'],
                        missing_data_requests: []
                    }
                };
            }

            function renderMockVerdict(result) {
                const panelId = 'ai-validation-panel';
                let panel = document.getElementById(panelId);
                if (!panel) {
                    panel = document.createElement('div');
                    panel.id = panelId;
                    panel.style.marginTop = '12px';
                    const container = document.getElementById('summaryContainer') || document.body;
                    container.appendChild(panel);
                }
                const verdict = result?.verdict || 'inconclusive';
                const confidence = result?.confidence != null ? Math.round(result.confidence * 100) + '%' : '—';
                const findings = result?.key_findings || [];
                const color = verdict === 'verified' ? '#0f766e'
                            : verdict === 'likely_inflation' ? '#b91c1c'
                            : verdict === 'inconclusive' ? '#92400e'
                            : '#4b5563';

                panel.style.display = 'block';
                panel.style.border = `1px solid ${color}33`;
                panel.style.background = '#f8fafc';
                panel.style.borderRadius = '12px';
                panel.style.padding = '12px';
                panel.style.color = '#0f172a';
                panel.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                      <div style="font-weight:700;color:${color}">Verdict: ${verdict}</div>
                      <div style="font-size:12px;color:#475569;">Confidence: ${confidence}</div>
                    </div>
                    <div style="font-size:13px;color:#475569;margin-bottom:6px;">Key Findings</div>
                    <div style="display:flex;flex-direction:column;gap:6px;">
                      ${findings.map((f) => `
                        <div style="padding:8px;border:1px solid #e2e8f0;border-radius:10px;background:#fff;">
                          <div style="font-weight:600;color:#0f172a;">${f.title || 'Finding'}</div>
                          <div style="font-size:13px;color:#475569;margin-top:4px;">${f.detail || ''}</div>
                          <div style="font-size:12px;color:#94a3b8;margin-top:4px;">Conf: ${Math.round((f.confidence||0)*100)}%</div>
                        </div>
                      `).join('')}
                    </div>
                `;
            }

            btn.addEventListener('click', async () => {
                const urlInput = document.getElementById('urlInput');
                const targetUrl = urlInput?.value || window.location.href;
                btn.disabled = true;
                btn.textContent = 'Sending...';
                try {
                    const payload = {
                        toolId: 'injected_telemetry',
                        scanId: scanResults?.scanId || `telemetry-${Date.now()}`,
                        evidencePack: {
                            version: '1.0',
                            createdAt: new Date().toISOString(),
                            target: { url: targetUrl, domain: '' },
                            findings: scanResults?.findings || [],
                            telemetry: scanResults?.summary || {},
                            artifacts: []
                        }
                    };
                    const { result } = await mockValidate(payload);
                    renderMockVerdict(result);
                    btn.textContent = 'AI Validate';
                    btn.disabled = false;
                } catch (error) {
                    alert(`AI validation failed: ${error.message}`);
                    btn.textContent = 'AI Validate';
                    btn.disabled = false;
                }
            });
        })();
    </script>

    <footer class="footer">
        <div class="footer-content">
            <p class="footer-disclaimer">
                <strong>Disclaimer:</strong> The results provided by this tool are for informational purposes only. Cybertect does not guarantee the accuracy, completeness, or reliability of scan results. Results may contain false positives or false negatives. Users should verify findings independently before making business decisions. Cybertect is not liable for any decisions made based on these results.
            </p>
            <div class="footer-links">
                <a href="/terms-of-service.html">Terms of Service</a>
                <span class="footer-separator">|</span>
                <a href="/privacy-policy.html">Privacy Policy</a>
            </div>
            <p class="footer-copyright">© 2025 Cybertect. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>

